<Project>
    <PropertyGroup>
        <Nullable>enable</Nullable>
    </PropertyGroup>

    <!-- Copy documentation files generated by the source generator from obj/DocsGenerated/<ProjectName> to the project directory -->
    <Target Name="CopyGeneratedDocumentation" AfterTargets="Build">
        <ItemGroup>
            <GeneratedDocs Include="$(MSBuildProjectDirectory)\obj\DocsGenerated\$(MSBuildProjectName)\**\*.*" Condition="Exists('$(MSBuildProjectDirectory)\obj\DocsGenerated\$(MSBuildProjectName)')" />
        </ItemGroup>

        <Message Text="Copying generated documentation @(GeneratedDocs->'%(FullPath)') to $(MSBuildProjectDirectory)" Importance="Low" Condition="'@(GeneratedDocs)' != ''" />

        <!-- DestinationFiles maps the recursive dir under obj/DocsGenerated/<ProjectName> back to the project directory preserving subfolders -->
        <Copy SourceFiles="@(GeneratedDocs)" DestinationFiles="@(GeneratedDocs->'$(MSBuildProjectDirectory)%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="true" Condition="'@(GeneratedDocs)' != ''" />
    </Target>

    <!-- Clean up generated documentation on Clean -->
    <Target Name="CleanGeneratedDocumentation" AfterTargets="Clean">
        <RemoveDir Directories="$(MSBuildProjectDirectory)\obj\DocsGenerated\$(MSBuildProjectName)" Condition="Exists('$(MSBuildProjectDirectory)\obj\DocsGenerated\$(MSBuildProjectName)')" />
    </Target>
</Project>
